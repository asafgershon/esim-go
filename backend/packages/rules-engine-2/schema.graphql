# Pricing Rules Engine Types
enum RuleCategory {
  PROVIDER_SELECTION
  DISCOUNT
  CONSTRAINT
  FEE
  BUNDLE_ADJUSTMENT
}

enum ConditionOperator {
  EQUALS
  NOT_EQUALS
  GREATER_THAN
  LESS_THAN
  BETWEEN
  IN
  NOT_IN
  EXISTS
  NOT_EXISTS
}

enum ActionType {
  APPLY_DISCOUNT_PERCENTAGE
  APPLY_FIXED_DISCOUNT
  SET_MINIMUM_PRICE
  SET_MINIMUM_PROFIT
  ADD_MARKUP
  SET_PROCESSING_RATE
  SET_DISCOUNT_PER_UNUSED_DAY
}

type RuleCondition {
  field: String!
  operator: ConditionOperator!
  value: JSON!
  type: String
}

type RuleAction {
  type: ActionType!
  value: Float!
  metadata: JSON
}

type DiscountApplication {
  ruleName: String!
  amount: Float!
  type: String! # 'percentage' or 'fixed'
}

input RuleConditionInput {
  field: String!
  operator: ConditionOperator!
  value: JSON!
  type: String
}

input RuleActionInput {
  type: ActionType!
  value: Float!
  metadata: JSON
}

input PricingRuleFilter {
  category: RuleCategory
  isActive: Boolean
  isEditable: Boolean
  validFrom: String
  validUntil: String
}

type PricingRule {
  id: ID!
  category: RuleCategory!
  name: String!
  description: String

  # Rule definition
  conditions: [RuleCondition!]!
  actions: [RuleAction!]!

  # Metadata
  priority: Int!
  isActive: Boolean!
  isEditable: Boolean!
  validFrom: String
  validUntil: String

  # Audit
  createdBy: String!
  createdAt: String!
  updatedAt: String!
}

type AppliedRule {
  id: ID!
  name: String!
  category: RuleCategory!
  impact: Float!
}

type PricingRuleCalculation {
  baseCost: Float!
  markup: Float!
  subtotal: Float!

  # Discounts breakdown
  discounts: [DiscountApplication!]!
  totalDiscount: Float!
  priceAfterDiscount: Float!

  # Processing fees
  processingFee: Float!
  processingRate: Float!

  # Final results
  finalPrice: Float!
  finalRevenue: Float! # What you get after payment (finalPrice - processingFee - baseCost)
  revenueAfterProcessing: Float! # Bottom line (finalPrice - processingFee)
  profit: Float!

  # Recommendations
  maxRecommendedPrice: Float! # baseCost + $1.50
  maxDiscountPercentage: Float! # Maximum discount % while maintaining minimum profit
  # Applied rules
  appliedRules: [AppliedRule!]!

  selectedBundle: CountryBundle!
}

input CreatePricingRuleInput {
  category: RuleCategory!
  name: String!
  description: String
  conditions: [RuleConditionInput!]!
  actions: [RuleActionInput!]!
  priority: Int!
  isActive: Boolean
  validFrom: String
  validUntil: String
}

input UpdatePricingRuleInput {
  name: String
  description: String
  conditions: [RuleConditionInput!]
  actions: [RuleActionInput!]
  priority: Int
  isActive: Boolean
  validFrom: String
  validUntil: String
}

input PricingRulePriorityUpdate {
  id: ID!
  priority: Int!
}

# GraphQL Query Extensions
extend type Query {
  # Pricing Rules Engine
  pricingRules(filter: PricingRuleFilter): [PricingRule!]!
  pricingRule(id: ID!): PricingRule
}

# GraphQL Mutation Extensions  
extend type Mutation {
  # Pricing Rules Engine
  createPricingRule(input: CreatePricingRuleInput!): PricingRule!
  updatePricingRule(id: ID!, input: UpdatePricingRuleInput!): PricingRule!
  deletePricingRule(id: ID!): Boolean!
  togglePricingRule(id: ID!): PricingRule!
  updatePricingRulePriorities(updates: [PricingRulePriorityUpdate!]!): [PricingRule!]!
  clonePricingRule(id: ID!, newName: String!): PricingRule!
  reorderPricingRules(updates: [PricingRulePriorityUpdate!]!): [PricingRule!]!
}
